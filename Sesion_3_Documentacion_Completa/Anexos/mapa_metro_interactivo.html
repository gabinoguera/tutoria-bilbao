<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Interactivo - Metro Bilbao</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        #map {
            height: 100vh;
            width: 100%;
        }
        .info-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            min-width: 200px;
        }
        .info-panel h3 {
            margin-bottom: 10px;
            color: #333;
            font-size: 14px;
            border-bottom: 2px solid #0066CC;
            padding-bottom: 5px;
        }
        .info-panel .stat {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 13px;
        }
        .info-panel .stat-value {
            font-weight: bold;
            color: #0066CC;
        }
        .legend {
            position: absolute;
            bottom: 30px;
            left: 10px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        .legend h4 {
            margin-bottom: 10px;
            font-size: 13px;
            color: #333;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 6px 0;
            font-size: 12px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        .legend-line {
            width: 30px;
            height: 4px;
            margin-right: 10px;
            border-radius: 2px;
        }
        .l1-color { background: #0066CC; }
        .l2-color { background: #FF6600; }
        .l3-color { background: #4CAF50; }
        .interchange-color { background: #FFD700; border: 2px solid #B8860B !important; }
        .popup-content {
            font-family: 'Segoe UI', sans-serif;
        }
        .popup-content h4 {
            margin: 0 0 8px 0;
            padding-bottom: 5px;
            border-bottom: 2px solid;
        }
        .popup-content p {
            margin: 4px 0;
            font-size: 12px;
            color: #555;
        }
        .popup-content .code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="info-panel">
        <h3>üöá Metro Bilbao</h3>
        <div class="stat">
            <span>Total estaciones:</span>
            <span class="stat-value" id="total-stations">0</span>
        </div>
        <div class="stat">
            <span>L√≠nea 1:</span>
            <span class="stat-value" style="color: #0066CC;" id="l1-count">0</span>
        </div>
        <div class="stat">
            <span>L√≠nea 2:</span>
            <span class="stat-value" style="color: #FF6600;" id="l2-count">0</span>
        </div>
        <div class="stat">
            <span>L√≠nea 3:</span>
            <span class="stat-value" style="color: #4CAF50;" id="l3-count">0</span>
        </div>
        <div class="stat">
            <span>Intercambiadores:</span>
            <span class="stat-value" style="color: #B8860B;" id="interchange-count">0</span>
        </div>
    </div>
    
    <div class="legend">
        <h4>üó∫Ô∏è Leyenda</h4>
        <div class="legend-item">
            <div class="legend-color l1-color"></div>
            <span>L√≠nea 1 (Etxebarri - Plentzia)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color l2-color"></div>
            <span>L√≠nea 2 (Basauri - Kabiezes)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color l3-color"></div>
            <span>L√≠nea 3 (Kukullaga - Matiko)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color interchange-color"></div>
            <span>Intercambiador</span>
        </div>
        <div class="legend-item">
            <div class="legend-line l1-color"></div>
            <span>Trayecto L1</span>
        </div>
        <div class="legend-item">
            <div class="legend-line l2-color"></div>
            <span>Trayecto L2</span>
        </div>
    </div>

    <script>
        // Datos de estaciones del Metro Bilbao (agrupados por c√≥digo)
        const stationsData = {
            // L√≠nea 1: Etxebarri - Plentzia (y tramo com√∫n)
            'ETX': { name: 'Etxebarri', lat: 43.24387, lon: -2.89668, line: 'L1', order: 1 },
            'BOL': { name: 'Bolueta', lat: 43.24700, lon: -2.90573, line: 'L1', order: 2 },
            'BAS': { name: 'Basarrate', lat: 43.25077, lon: -2.91057, line: 'L1', order: 3 },
            'SAN': { name: 'Santutxu', lat: 43.25383, lon: -2.91343, line: 'L1', order: 4 },
            'CAV': { name: 'Casco Viejo', lat: 43.26024, lon: -2.91987, line: 'L1', order: 5, interchange: true },
            'ABA': { name: 'Abando', lat: 43.26144, lon: -2.92820, line: 'L1', order: 6, interchange: true },
            'MOY': { name: 'Moyua', lat: 43.26267, lon: -2.93377, line: 'L1', order: 7 },
            'IND': { name: 'Indautxu', lat: 43.26125, lon: -2.94234, line: 'L1', order: 8 },
            'SAM': { name: 'San Mam√©s', lat: 43.26254, lon: -2.94819, line: 'L1', order: 9, interchange: true },
            'DEU': { name: 'Deusto', lat: 43.27182, lon: -2.94947, line: 'L1', order: 10 },
            'SAR': { name: 'Sarriko', lat: 43.27441, lon: -2.95807, line: 'L1', order: 11 },
            'SIN': { name: 'San Inazio', lat: 43.28137, lon: -2.96265, line: 'L1', order: 12 },
            'LUT': { name: 'Lutxana', lat: 43.29113, lon: -2.97005, line: 'L1', order: 13 },
            'ERA': { name: 'Erandio', lat: 43.30379, lon: -2.97447, line: 'L1', order: 14 },
            'AST': { name: 'Astrabudua', lat: 43.31448, lon: -2.98677, line: 'L1', order: 15 },
            'LEI': { name: 'Leioa', lat: 43.31799, lon: -2.99203, line: 'L1', order: 16 },
            'LAM': { name: 'Lamiako', lat: 43.32142, lon: -3.00159, line: 'L1', order: 17 },
            'ARE': { name: 'Areeta', lat: 43.32651, lon: -3.01040, line: 'L1', order: 18 },
            'GOB': { name: 'Gobela', lat: 43.33360, lon: -3.00704, line: 'L1', order: 19 },
            'NEG': { name: 'Neguri', lat: 43.34035, lon: -3.00631, line: 'L1', order: 20 },
            'AIB': { name: 'Aiboa', lat: 43.34359, lon: -3.00288, line: 'L1', order: 21 },
            'ALG': { name: 'Algorta', lat: 43.34988, lon: -3.00910, line: 'L1', order: 22 },
            'BID': { name: 'Bidezabal', lat: 43.35694, lon: -3.01166, line: 'L1', order: 23 },
            'IBB': { name: 'Ibarbengoa', lat: 43.36317, lon: -3.00667, line: 'L1', order: 24 },
            'BER': { name: 'Berango', lat: 43.36676, lon: -2.99942, line: 'L1', order: 25 },
            'LAR': { name: 'Larrabasterra', lat: 43.37554, lon: -2.99160, line: 'L1', order: 26 },
            'SOP': { name: 'Sopelana', lat: 43.38017, lon: -2.97879, line: 'L1', order: 27 },
            'URD': { name: 'Urduliz', lat: 43.37865, lon: -2.95905, line: 'L1', order: 28 },
            'PLE': { name: 'Plentzia', lat: 43.40183, lon: -2.94640, line: 'L1', order: 29 },
            
            // L√≠nea 2: Basauri - Kabiezes (ramificaci√≥n desde San Inazio)
            'BSR': { name: 'Basauri', lat: 43.23656, lon: -2.89457, line: 'L2', order: 1 },
            'ARZ': { name: 'Ariz', lat: 43.23767, lon: -2.88255, line: 'L2', order: 2 },
            'GUR': { name: 'Gurutzeta/Cruces', lat: 43.28320, lon: -2.98296, line: 'L2', order: 13, interchange: true },
            'ANS': { name: 'Ansio', lat: 43.28975, lon: -2.98699, line: 'L2', order: 14 },
            'BAR': { name: 'Barakaldo', lat: 43.29531, lon: -2.98890, line: 'L2', order: 15, interchange: true },
            'BAG': { name: 'Bagatza', lat: 43.29849, lon: -2.99262, line: 'L2', order: 16 },
            'URB': { name: 'Urbinaga', lat: 43.30593, lon: -2.99238, line: 'L2', order: 17 },
            'SES': { name: 'Sestao', lat: 43.30934, lon: -3.00663, line: 'L2', order: 18 },
            'ABT': { name: 'Abatxolo', lat: 43.31376, lon: -3.01251, line: 'L2', order: 19 },
            'POR': { name: 'Portugalete', lat: 43.31795, lon: -3.02144, line: 'L2', order: 20 },
            'PEN': { name: 'Pe√±ota', lat: 43.32200, lon: -3.02593, line: 'L2', order: 21 },
            'STZ': { name: 'Santurtzi', lat: 43.32923, lon: -3.03426, line: 'L2', order: 22 },
            'KAB': { name: 'Kabiezes', lat: 43.32231, lon: -3.03661, line: 'L2', order: 23 },
            
            // L√≠nea 3 (nuevas estaciones)
            'ZZA': { name: 'Matiko', lat: 43.26892, lon: -2.92499, line: 'L3', order: 1 },
            'ZZB': { name: 'Uribarri', lat: 43.26658, lon: -2.91811, line: 'L3', order: 2 },
            'ZZC': { name: 'Casco Viejo (L3)', lat: 43.26024, lon: -2.91987, line: 'L3', order: 3, interchange: true },
            'ZZD': { name: 'Zurbaranbarri', lat: 43.26483, lon: -2.91345, line: 'L3', order: 4 },
            'ZZE': { name: 'Txurdinaga', lat: 43.25794, lon: -2.90674, line: 'L3', order: 5 },
            'ZZF': { name: 'Otxarkoaga', lat: 43.25819, lon: -2.89808, line: 'L3', order: 6 },
            'ZZG': { name: 'Kukullaga', lat: 43.25113, lon: -2.88981, line: 'L3', order: 7 }
        };

        // Orden de estaciones para las polylines
        const l1Route = ['ETX', 'BOL', 'BAS', 'SAN', 'CAV', 'ABA', 'MOY', 'IND', 'SAM', 'DEU', 'SAR', 'SIN', 'LUT', 'ERA', 'AST', 'LEI', 'LAM', 'ARE', 'GOB', 'NEG', 'AIB', 'ALG', 'BID', 'IBB', 'BER', 'LAR', 'SOP', 'URD', 'PLE'];
        const l2RouteA = ['BSR', 'ARZ', 'ETX', 'BOL', 'BAS', 'SAN', 'CAV', 'ABA', 'MOY', 'IND', 'SAM', 'DEU', 'SAR', 'SIN'];
        const l2RouteB = ['SIN', 'GUR', 'ANS', 'BAR', 'BAG', 'URB', 'SES', 'ABT', 'POR', 'PEN', 'STZ', 'KAB'];
        const l3Route = ['ZZA', 'ZZB', 'ZZC', 'ZZD', 'ZZE', 'ZZF', 'ZZG'];

        // Colores
        const colors = {
            L1: '#0066CC',
            L2: '#FF6600',
            L3: '#4CAF50',
            interchange: '#FFD700'
        };

        // Inicializar mapa centrado en Bilbao
        const map = L.map('map').setView([43.2627, -2.9253], 12);

        // A√±adir tiles de OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> | Metro Bilbao Open Data'
        }).addTo(map);

        // Funci√≥n para crear polyline de una ruta
        function createRouteLine(route, color) {
            const coords = route
                .filter(code => stationsData[code])
                .map(code => [stationsData[code].lat, stationsData[code].lon]);
            
            return L.polyline(coords, {
                color: color,
                weight: 4,
                opacity: 0.7,
                lineJoin: 'round'
            }).addTo(map);
        }

        // Dibujar las l√≠neas de conexi√≥n
        createRouteLine(l1Route, colors.L1);
        createRouteLine(l2RouteA, colors.L2);
        createRouteLine(l2RouteB, colors.L2);
        createRouteLine(l3Route, colors.L3);

        // Contadores
        let l1Count = 0, l2Count = 0, l3Count = 0, interchangeCount = 0;

        // Crear marcadores para cada estaci√≥n
        Object.entries(stationsData).forEach(([code, station]) => {
            const isInterchange = station.interchange;
            const color = isInterchange ? colors.interchange : colors[station.line];
            const radius = isInterchange ? 10 : 7;
            const borderColor = isInterchange ? '#B8860B' : color;
            
            // Contar estaciones
            if (station.line === 'L1') l1Count++;
            else if (station.line === 'L2') l2Count++;
            else if (station.line === 'L3') l3Count++;
            if (isInterchange) interchangeCount++;

            // Crear marcador circular
            const marker = L.circleMarker([station.lat, station.lon], {
                radius: radius,
                fillColor: color,
                color: borderColor,
                weight: isInterchange ? 3 : 2,
                opacity: 1,
                fillOpacity: 0.9
            }).addTo(map);

            // Popup informativo
            const lineColor = colors[station.line];
            const popupContent = `
                <div class="popup-content">
                    <h4 style="border-color: ${lineColor}; color: ${lineColor};">
                        ${isInterchange ? 'üöâ ' : ''}${station.name}
                    </h4>
                    <p><strong>C√≥digo:</strong> <span class="code">${code}</span></p>
                    <p><strong>L√≠nea:</strong> <span style="color: ${lineColor}; font-weight: bold;">${station.line}</span></p>
                    <p><strong>Lat:</strong> ${station.lat.toFixed(5)}</p>
                    <p><strong>Lon:</strong> ${station.lon.toFixed(5)}</p>
                    ${isInterchange ? '<p style="color: #B8860B;"><strong>‚ö° Intercambiador</strong></p>' : ''}
                </div>
            `;
            marker.bindPopup(popupContent);

            // Tooltip con nombre
            marker.bindTooltip(station.name, {
                permanent: false,
                direction: 'top',
                offset: [0, -8]
            });
        });

        // Actualizar panel informativo
        document.getElementById('total-stations').textContent = Object.keys(stationsData).length;
        document.getElementById('l1-count').textContent = l1Count;
        document.getElementById('l2-count').textContent = l2Count;
        document.getElementById('l3-count').textContent = l3Count;
        document.getElementById('interchange-count').textContent = interchangeCount;

        // Ajustar vista para mostrar toda la red
        const allCoords = Object.values(stationsData).map(s => [s.lat, s.lon]);
        map.fitBounds(allCoords, { padding: [50, 50] });
        
        console.log('‚úÖ Mapa del Metro Bilbao cargado correctamente');
        console.log(`üìç ${Object.keys(stationsData).length} estaciones renderizadas`);
    </script>
</body>
</html>
